<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Air Gap Installation - FHIR Server Docs</title>
<meta name="description" content=".">

<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="FHIR Server Docs">
<meta property="og:url" content="http://localhost:4000/FHIR-Server-Docs/installing/air-gap-installation/" />
<meta property="og:title" content="Documentation | Air Gap Installation" />
<meta property="og:description" content="." />

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="IBM Event Streams | Air Gap Installation" />




  <meta property="og:description" content=".">



  <meta property="og:image" content="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/appIcon_og_fb.png">
  <meta name="twitter:image" content="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/appIcon_og_square.png">



  <meta property="article:published_time" content="2021-03-12T16:58:25+00:00">






<link rel="canonical" href="http://localhost:4000/FHIR-Server-Docs/installing/air-gap-installation/">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000/FHIR-Server-Docs",
      "logo": "http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/appIcon_og_fb.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "IBM",
      "url": "http://localhost:4000/FHIR-Server-Docs",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/FHIR-Server-Docs/feed.xml" type="application/atom+xml" rel="alternate" title="FHIR Server Docs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/FHIR-Server-Docs/assets/css/main.css">



<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="shortcut icon" type="image/png" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/favicon.ico"/>
<link rel="shortcut icon" type="image/png" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/fhir-icon-16.png"/>
<link rel="shortcut icon" type="image/png" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/fhir-icon3.png"/>
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/fhir-icon3.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/fhir-icon-16.png">
<link rel="manifest" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/site.webmanifest">
<link rel="mask-icon" href="http://localhost:4000/FHIR-Server-Docs/assets/siteMeta/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#000000">
<meta name="theme-color" content="#000000">

<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600%7CIBM+Plex+Serif:300,400,500%7CIBM+Plex+Mono:300,400,500,700" rel="stylesheet">

<!-- end custom head snippets -->

    <link rel="shortcut icon" type="image/x-icon" href="/FHIR-Server-Docs/assets/favicon.ico" >
    
    <base target="_parent">

  </head>
  <script src="/FHIR-Server-Docs/assets/animation/lottie.js" type="text/javascript"></script>
  <script src="/FHIR-Server-Docs/assets/js/connectors.js"></script>


  
  <body onload="urlChecker()" class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    




 <div id="masthead" class="masthead">
  <div class="masthead__goToIBMCloud">
 <!-- <div>
    You are viewing the documentation for the container-native version of IBM FHIR Server.
  </div> 
   <a class="link" target="_self" href="https://www.ibm.com/products/fhir-server">Looking for the managed service on IBM Cloud? Click here.</a> -->
</div> 
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="mastheadNav">

      


        <div class="mastheadTitle">
          
          <a class="site-title" href="/FHIR-Server-Docs/" target="_self"><span>IBM</span>&nbsp;FHIR Server</a>
          <div class="viewOnIBMcom">
            <a href="https://www.ibm.com/products/fhir-server" target="_blank">View product page</a>
          </div>
        </div>









        <div class="mastheadControls">
            <div class="menuScrollContainer">

        

                <ul id="visible-links" class="visible-links">
                  
                  
                  

                  




                  
                    <li class="masthead__menu-item active" onclick="window.open('http://localhost:4000/FHIR-Server-Docs/','_self')">
                      <a href="http://localhost:4000/FHIR-Server-Docs/" >Documentation</a>
                    </li>
                  

                  
                  
                  

                  




                  
                    <li class="masthead__menu-item " onclick="window.open('http://localhost:4000/FHIR-Server-Docs/tutorials/','_self')">
                      <a href="http://localhost:4000/FHIR-Server-Docs/tutorials/" >Tutorials</a>
                    </li>
                  

                  
                  
                  

                  




                  
                    <li class="masthead__menu-item " onclick="window.open('http://localhost:4000/FHIR-Server-Docs/faq/','_self')">
                      <a href="http://localhost:4000/FHIR-Server-Docs/faq/" >FAQ</a>
                    </li>
                  

                  
                  
                  

                  




                  
                    <li class="masthead__menu-item " onclick="window.open('http://localhost:4000/FHIR-Server-Docs/support/','_self')">
                      <a href="http://localhost:4000/FHIR-Server-Docs/support/" >Support</a>
                    </li>
                  

                  
                  
                  

                  




                  
                    <li class="masthead__menu-item " onclick="window.open('http://localhost:4000/FHIR-Server-Docs/search/','_self')">
                      <button aria-label="Search Button" role="button" id="searchButton" class="search__toggle " type="button" name="search Button">
                        <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                          <path
                            d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z"
                            transform="translate(-.01)"></path>
                        </svg>
                      </button>
                    </li>
                  

                  
                </ul>
        

      </div>
    </div>
      </nav>
    </div>
  </div>
</div>


    <div id="initial-content" class="initial-content" role="main">





<main id="main" class="mainContainer" role="main">
    
      <div id="subMenu" class="subMenu">
        <div tabindex="0" class="menuIcon" id="menuIcon">
          <svg id="mobileMenu" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
            <g id="bottomLine">
              <line class="burgerLine" x1="14" y1="29" x2="34" y2="29" />
            </g>
            <g id="middleLine">
              <line class="burgerLine" x1="14" y1="24" x2="34" y2="24" />
            </g>
            <g id="topLine">
              <line class="burgerLine" x1="14" y1="19" x2="34" y2="19" />
            </g>
          </svg>
        </div>
        <div id="mobileVersionShortcut" class="versionContainer" tabindex="0">
          <a id="mobileVersionPillCurrent" class="versionPill">1.0</a>
        </div>
      </div>
    
  


  <div id="sidebarMask" class="sidebarMask">

  </div>
  <div id="sidebar" class="sidebar sticky">
      <div aria-label="Change Version" role="button" aria-expanded="false"
      
        id="versionDropdown"
        tabindex="0"
        class="versionsBar"
       >
          <div class="selectedVersion" id="selectedVersion">
            <div class="versionContainer" >
              
                <a id="versionPillCurrent" class="versionPill">1.0</a>
                <a class="versionChange">Change Version</a>
              
            </div>
          </div>
          


          <div class="allVersions" id="allVersions">
            <ul>

                

                        


                    

                    <!--  -->

                    

                    


                    <li class="version" data-url="http://localhost:4000/FHIR-Server-Docs/installing/air-gap-installation/" onclick="openVersion('http://localhost:4000/FHIR-Server-Docs/installing/air-gap-installation/','1.0')">

                        <div class="pillContainer">
                          
                          <a tabindex="-1" href="http://localhost:4000/FHIR-Server-Docs/installing/air-gap-installation/" class="versionPill active">1.0</a>
                        </div>
                        <div class="activeContainer">
                            
                            <img alt="" src="http://localhost:4000/FHIR-Server-Docs/images/checkbox.svg" />
                            
                        </div>
                        <div class="latest">
                            Latest
                        </div>
                      </li>

                

            </ul>
          </div>
        </div>

  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <ul class="nav__items">

    
      <li>
        
          <span class="nav__sub-title">About</span>
        

        
        <ul>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/about/overview/" class="">Introduction</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/about/documentation/" class="">Documentation</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/about/license/" class="">License</a>
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Installing and upgrading</span>
        

        
        <ul>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/trying-out/" class="">Installing IBM FHIR Server</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/prerequisites/" class="">Prerequisites</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/installing/" class="">Installing</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/configuring/" class="">Configuring</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/air-gap-installation/" class="active">Air Gap Installation</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/installing/tracking-license/" class="">Tracking license consumption of IBM FHIR Server</a>
            </li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Security</span>
        

        
        <ul>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/security/security/" class="">Security</a>
            </li>
          
            
            

            
            


      

            

            <li>


          

                    

              <a href="/FHIR-Server-Docs/security/security-context-constraints/" class="">SecurityContextConstraints Requirements</a>
            </li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <div class="mainContent">
    
    <div id="pageContainer" class="page" itemscope itemtype="http://schema.org/CreativeWork">
      <div class="page__inner-wrap  latestVersion">
        
        <section class="page__content pageSpacing" itemprop="text">
          
          <header>
            <h1 id="page-title" class="page__title" itemprop="headline">
              Air Gap Installation
</h1>
            
          </header>
          
          <div class="content">
            <h2 id="air-gap-installation">Air Gap Installation</h2>

<p>Since air gap environments do not have access to the public internet, and therefore no access to DockerHub, the following preparation steps are necessary to make the required images accessable to the Red Hat OpenShift Container Platform cluster.</p>

<p>If the Red Hat OpenShift Container Platform cluster has a Bastion host, ensure that the Bastion host can access:</p>

<ul>
  <li>The public internet to download the CASE and images.</li>
  <li>The target (air gap) image registry where all the images will be mirrored to.</li>
  <li>The Red Hat OpenShift Container Platform cluster to install the Operator on.</li>
</ul>

<p>In the absence of a Bastion host, a portable host with access to the public internet may used. By downloading the CASE and images onto the portable host, and then transporting the portable host into the air gap environment, the images can then be mirrored to the target (air gap) image registry.</p>

<p>If using a Bastion host, refer to <a href="#using-a-bastion-host">Using a Bastion host</a>.
If using a portable host, refer to <a href="#using-a-portable-host">Using a portable host</a>.</p>

<h3 id="using-a-bastion-host">Using a Bastion host</h3>

<h4 id="1-prepare-the-bastion-host">1. Prepare the Bastion host</h4>

<p>Ensure you have the following installed on the Bastion host:</p>

<ul>
  <li><a href="https://docker.com">Docker CLI (docker)</a></li>
  <li><a href="https://github.com/IBM/cloud-pak-cli">IBM Cloud Pak CLI (cloudctl)</a></li>
  <li><a href="https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html">Red Hat OpenShift Container Platform CLI (oc)</a></li>
  <li><a href="https://github.com/containers/skopeo">Skopeo (skopeo)</a></li>
</ul>

<h4 id="2-download-the-case">2. Download the CASE</h4>

<ol>
  <li>Create a local directory in which to save the CASE.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir -p $HOME/offline
</code></pre></div></div>

<ol>
  <li>Save the CASE.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case save --case &lt;case-path&gt; --outputdir $HOME/offline
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-path&gt;</code> is the path or URL to the CASE to save.</li>
</ul>

<p>The following output is displayed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Downloading and extracting the CASE ...
- Success
Retrieving CASE version ...
- Success
Validating the CASE ...
- Success
Creating inventory ...
- Success
Finding inventory items
- Success
Resolving inventory items ...
Parsing inventory items
- Success
</code></pre></div></div>

<ol>
  <li>Verify the CASE (.tgz) file and images (.csv) file have been downloaded.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls $HOME/offline
charts
ibm-fhir-server-case-&lt;version&gt;-charts.csv
ibm-fhir-server-case-&lt;version&gt;-images.csv
ibm-fhir-server-case-&lt;version&gt;.tgz
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;version&gt;</code> is the CASE version.</li>
</ul>

<h4 id="3-log-into-cluster">3. Log into cluster</h4>

<p>Log into the Red Hat OpenShift Container Platform cluster as a cluster administrator using the <code class="language-plaintext highlighter-rouge">oc login</code> command.</p>

<h4 id="4-configure-target-registry-authentication-secret">4. Configure target registry authentication secret</h4>

<p>For IBM FHIR Server, all images are available publicly in DockerHub, so no authentication secret for the source (public) registry is needed.</p>

<ol>
  <li>Create the authentication secret for the target (air gap) registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action configure-creds-airgap \
    --args "--registry &lt;target-registry&gt; --user &lt;registry-user&gt; --pass &lt;registry-password&gt;"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-user&gt;</code> is the username for the target registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-password&gt;</code> is the password for the target registry.</li>
</ul>

<p>The credentials are saved to <code class="language-plaintext highlighter-rouge">$HOME/.airgap/secrets/&lt;target-registry&gt;.json</code></p>

<h4 id="5-mirror-images-to-target-registry">5. Mirror images to target registry</h4>

<ol>
  <li>Copy the images in the CASE from the source (public) registry to the target (air gap) registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action mirror-images \
    --args "--registry &lt;target-registry&gt; --inputDir $HOME/offline"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<h4 id="6-configure-cluster-to-access-target-registry">6. Configure cluster to access target registry</h4>

<ol>
  <li>Configure a global image pull secret and ImageContentSourcePolicy resource.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --namespace openshift-marketplace \
    --inventory ibmFhirServerOperatorSetup \
    --action configure-cluster-airgap \
    --args "--registry &lt;target-registry&gt; --inputDir $HOME/offline"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<p><em>WARNING:</em> This step may restart all cluster nodes. The cluster resources might be unavailable until the time the new pull secret is applied.</p>

<ol>
  <li>Optional: If you are using an insecure target registry, you must add the target registry to the cluster insecureRegistries list.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ oc patch image.config.openshift.io/cluster --type=merge \
    -p '{"spec":{"registrySources":{"insecureRegistries":["'&lt;target-registry&gt;'"]}}}'
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<h4 id="7-proceed-with-installation">7. Proceed with installation</h4>

<p>Now that the air gap installation preparation steps are complete, you may continue with the <a href="../installing">IBM FHIR Server Operator installation</a>.</p>

<h3 id="using-a-portable-host">Using a portable host</h3>

<h4 id="1-prepare-the-portable-host">1. Prepare the portable host</h4>

<p>Ensure you have the following installed on the portable host:</p>

<ul>
  <li><a href="https://docker.com">Docker CLI (docker)</a></li>
  <li><a href="https://github.com/IBM/cloud-pak-cli">IBM Cloud Pak CLI (cloudctl)</a></li>
  <li><a href="https://docs.openshift.com/container-platform/4.4/cli_reference/openshift_cli/getting-started-cli.html">Red Hat OpenShift Container Platform CLI (oc)</a></li>
  <li><a href="https://github.com/containers/skopeo">Skopeo (skopeo)</a></li>
</ul>

<h4 id="2-download-the-case-1">2. Download the CASE</h4>

<ol>
  <li>Create a local directory in which to save the CASE.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir -p $HOME/offline
</code></pre></div></div>

<ol>
  <li>Save the CASE.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case save --case &lt;case-path&gt; --outputdir $HOME/offline
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-path&gt;</code> is the path or URL to the CASE to save.</li>
</ul>

<p>The following output is displayed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Downloading and extracting the CASE ...
- Success
Retrieving CASE version ...
- Success
Validating the CASE ...
- Success
Creating inventory ...
- Success
Finding inventory items
- Success
Resolving inventory items ...
Parsing inventory items
- Success
</code></pre></div></div>

<h4 id="3-configure-portable-registry-and-authentication-secret">3. Configure portable registry and authentication secret</h4>

<p>For IBM FHIR Server, all images are available publicly in DockerHub, so no authentication secret for the source (public) registry is needed.</p>

<ol>
  <li>Initialize the portable registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action init-registry \
    --args "--registry localhost --user &lt;registry-user&gt; --pass &lt;registry-password&gt; \
        --dir $HOME/offline/imageregistry"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-user&gt;</code> is the username for the registry, which is initialized to this value.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-password&gt;</code> is the password for the registry, which is initialized to this value.</li>
</ul>

<ol>
  <li>Start the portable registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action start-registry \
    --args "--registry localhost --port 443 --user &lt;registry-user&gt; --pass &lt;registry-password&gt; \
        --dir $HOME/offline/imageregistry"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-user&gt;</code> is the username for the registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-password&gt;</code> is the password for the registry.</li>
</ul>

<ol>
  <li>Create the authentication secret for the portable registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action configure-creds-airgap \
    --args "--registry localhost:443 --user &lt;registry-user&gt; --pass &lt;registry-password&gt;"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-user&gt;</code> is the username for the registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-password&gt;</code> is the password for the registry.</li>
</ul>

<p>The credentials are saved to <code class="language-plaintext highlighter-rouge">$HOME/.airgap/secrets/localhost:443.json</code></p>

<h4 id="4-mirror-images-to-portable-registry">4. Mirror images to portable registry</h4>

<ol>
  <li>The following step copies the images in the CASE from the source (public) registry to the portable registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action mirror-images \
    --args "--registry localhost:443 --inputDir $HOME/offline"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
</ul>

<h4 id="5-transport-portable-device">5. Transport portable device</h4>

<p>Now that the images are in the portable registry, transport the portable host into the air gap environment.</p>

<h4 id="6-log-into-the-cluster">6. Log into the cluster</h4>

<p>Log into the Red Hat OpenShift Container Platform cluster as a cluster administrator using the <code class="language-plaintext highlighter-rouge">oc login</code> command.</p>

<h4 id="7-configure-target-registry-authentication-secret">7. Configure target registry authentication secret</h4>

<ol>
  <li>Create the authentication secret for the target (air gap) registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action configure-creds-airgap \
    --args "--registry &lt;target-registry&gt; --user &lt;registry-user&gt; --pass &lt;registry-password&gt;"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-user&gt;</code> is the username for the target registry.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;registry-password&gt;</code> is the password for the target registry.</li>
</ul>

<p>The credentials are saved to <code class="language-plaintext highlighter-rouge">$HOME/.airgap/secrets/$TARGET_REGISTRY.json</code></p>

<h4 id="8-mirror-images-to-target-registry">8. Mirror images to target registry</h4>

<ol>
  <li>The following step copies the images in the CASE from the portable registry to the target (air gap) registry.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --inventory ibmFhirServerOperatorSetup \
    --action mirror-images \
    --args "--fromRegistry localhost:443 --registry &lt;target-registry&gt; --inputDir $HOME/offline"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<h4 id="9-configure-cluster-to-access-target-registry">9. Configure cluster to access target registry</h4>

<ol>
  <li>Configure a global image pull secret and ImageContentSourcePolicy resource.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cloudctl case launch \
    --case $HOME/offline/&lt;case-file&gt; \
    --namespace openshift-marketplace \
    --inventory ibmFhirServerOperatorSetup \
    --action configure-cluster-airgap \
    --args "--registry &lt;target-registry&gt; --inputDir $HOME/offline"
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;case-file&gt;</code> is the CASE file.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<p><em>WARNING:</em> This step may restart all cluster nodes. The cluster resources might be unavailable until the time the new pull secret is applied.</p>

<ol>
  <li>Optional: If you are using an insecure target registry, you must add the target registry to the cluster insecureRegistries list.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ oc patch image.config.openshift.io/cluster --type=merge \
    -p '{"spec":{"registrySources":{"insecureRegistries":["'&lt;target-registry&gt;'"]}}}'
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;target-registry&gt;</code> is the target registry.</li>
</ul>

<h4 id="10-proceed-with-installation">10. Proceed with installation</h4>

<p>Now that the air gap installation preparation steps are complete, you may continue with the installation.</p>

          </div>


          
        </section>

        <aside class="sidebar__right ">
          
          <div class="fixedSidebar">
            <nav class="toc">
              <ul class="toc__menu">
  <li><a href="#air-gap-installation">Air Gap Installation</a>
    <ul>
      <li><a href="#using-a-bastion-host">Using a Bastion host</a></li>
      <li><a href="#using-a-portable-host">Using a portable host</a></li>
    </ul>
  </li>
</ul>
            </nav>
          </div>
          
        </aside>


      </div>
      <div class="pageEnd">
        
          
  <nav class="pagination">
    
      <div class="previous" onclick="window.open('/FHIR-Server-Docs/installing/configuring/','_self')">
        <div class="container">
          <a href="/FHIR-Server-Docs/installing/configuring/" class="pagination--pager" title="Previous Item: Configuring
">Previous</a>
          <h2 class="titlePreview">Configuring
</h2>
        </div>
      </div>
    
    
      <div class="next" onclick="window.open('/FHIR-Server-Docs/installing/tracking-license/','_self')">
        <div class="container">
          <a href="/FHIR-Server-Docs/installing/tracking-license/" class="pagination--pager" title="Next Item: Tracking license consumption of IBM FHIR Server
">Next</a>
          <h2 class="titlePreview">Tracking license consumption of IBM FHIR Server
</h2>
        </div>
      </div>
      
  </nav>

        
      </div>
    </div>


  </div> <!-- Main content -->

</main></div>


    
      <div class="page__footer">
          <footer>
            <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

            
<div class="page__footer-copyright"><a href="https://www.ibm.com/privacy/us/en/" rel="nofollow" target="_blank">Privacy Policy</a>  &nbsp;© Copyright IBM Corporation 2020</br>
  Released under the <a href="https://www.apache.org/licenses/LICENSE-2.0" rel="nofollow" target="_blank">Apache License v2.0</a></div>

          </footer>
      </div>      
    


    
  <script src="/FHIR-Server-Docs/assets/js/main.min.js"></script>
  <!-- <script src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script> -->






<script src="/FHIR-Server-Docs/assets/js/design.js"></script>





<script src="/FHIR-Server-Docs/assets/js/lunr/lunr.min.js"></script>
<script src="/FHIR-Server-Docs/assets/js/lunr/lunr-store.js"></script>
<script src="/FHIR-Server-Docs/assets/js/lunr/lunr-en.js"></script>





    

    
  </body>
</html>
